---
title: "个人网页搭建笔记"
excerpt: "网页搭建模板Minimal-mistakes介绍"
categories:
  - Website Building
---

本文档主要记录搭建个人网站的教程笔记，主要使用GitHub Pages来免费托管网站，使用基于Jekyll工具的Minimal Mistakes模板来完成搭建。

## Jekyll工具安装与使用

首先介绍Jekyll工具的安装与使用（[Jekyll官方连接](https://jekyllrb.com/)）。该工具需要`Ruby`和`RubyGems`的支持。在准备好环境后通过以下代码进行安装和使用。

~~~shell
# 安装jekyll
gem install jekyll bundler
# 使用jekyll新建一个网站文件myblog
jekyll new myblog
# 进入myblog文件后，在本地运行网站，可通过http://localhost:4000访问
bundle exec jekyll serve
~~~

**注意:** 如果在`jekyll new myblog`一直加载，则可以直接通过`Ctrl+C`取消， 然后换源：通过将`Gemfile`文件中的`source "https://rubygems.org"`替换为`source "https://gems.ruby-china.com"`，然后再到`myblog`文件夹中运行`bundle install`。
{: .notice--info}

在新建的`myblog`文件夹中：

* `_posts`文件夹用于存储格式为markdown的博客文件，文件名格式为`YY-MM-DD-title.md`。

+ `_config.yml`是配置文件，用于设置网站标题、描述、插件、分页、部署等。

* `Gemfile`是Ruby项目的依赖管理文件，列出需要安装的插件。

* `index.markdown`是网站首页的内容文件。



## Minimal Mistakes主题加载与使用

接下来介绍Minimal Mistakes主题模板的使用（[Minimal Mistakes官方教程](https://mmistakes.github.io/minimal-mistakes/docs/quick-start-guide/)）。该模板提供了两种加载方式：

* 第一种是**远程加载**，直接从官方的GitHub仓库加载主题，不需要安装主题包，适合在GitHub Pages中部署。

* 第二种是**本地加载**，通过使用RubyGems来将主题包安装到本地。

### 远程加载

可通过[官方链接](https://github.com/mmistakes/mm-github-pages-starter/generate)直接在GitHub创建一个新仓库，如下图所示。

![创建新仓库](/assets/images/2025-11-06/0001.png)

新建的仓库包含以下文件：

![新仓库文件](/assets/images/2025-11-06/0002.png)

**注意：**相比使用`Jekyll`建立的文件，多出了`_data`、`_pages`、`assets`。这些文件夹同样用于网页的构建，具体内容在**本地加载**中介绍。
{: .notice--info}

在创建好该仓库后，即可通过`用户名.github.io`或`用户名.github.io/自定义仓库名`来访问网站。

### 本地加载

可以直接下载前面新建的仓库，也可以下载[官方仓库](https://github.com/mmistakes/minimal-mistakes)。其中官方仓库中的`docs`和`test`文件夹可以作为两个独立的网页项目，用于学习测试。

在获得项目文件夹后：

* 将文件夹中的`_config.yml`文件中的`remote_theme: mmistakes/minimal-mistakes`替换为`theme: minimal-mistakes-jekyll`。
* 在`Gemfile`文件中加入`gem "minimal-mistakes-jekyll"`，并在终端执行`bundle install`来在本地安装主题包。
* 在本地运行`bundle exec jekyll serve`即可通过`http://localhost:4000`进行访问。

接下来就可以通过[官方教程](https://mmistakes.github.io/minimal-mistakes/docs/quick-start-guide/)来修改项目中的文件配置进行网页客制化，以下介绍部分常用的功能。

* `_data`中的`navigation.yml`文件用于控制导航的显示，包括页眉的导航和博客中左侧栏的导航。
* `_pages`文件夹用于定义不同类型网页的布局。
* `assets`文件夹：`css`文件用来定义网页的字体等其他设置，用户可以再创建该文件来覆盖官方的设置；`images`文件夹用来存储网页或博客会用到的图片数据。



## Minimal Mistakes的进阶使用

### _config.yml文件配置

```yaml
# 用于选择minimal mistakes主题加载方式
remote_theme             : "mmistakes/minimal-mistakes@master"
# theme                  : minimal-mistakes-jekyll

# 选择主题皮肤
# 可选主题："air", "aqua", "contrast", "dark", "dirt", "neon", "mint", "plum", "sunrise"
minimal_mistakes_skin    : "dark" 
```

```yaml
# 网页基本信息设置

# 用于控制网页的文本显示，其余类型可以参考官方仓库中_data/ui-text.yml文件
locale                   : "en-US"
# 网页标题、分隔符及子标题
title                    : "Minimal Mistakes"
title_separator          : "-"
subtitle                 : "A Jekyll theme"
# 网页作者及介绍，使用YAML锚&name来定义可复用的变量，在文件其余地方用*name引用
name                     : &name "Michael Rose" 
description              : &description "A flexible Jekyll theme for your blog."
# 网页地址及对应仓库，在GitHub Pages似乎不用设置
url                      : https://mmistakes.github.io 
baseurl                  : "/minimal-mistakes"
repository               : "mmistakes/minimal-mistakes"
# 用于博客的封面图，也可以在博客的YAML Front Matter里单独设置
teaser                   : "/assets/images/500x300.png"
logo                     : "/assets/images/88x88.png"
masthead_title           : " "
# breadcrumbs            : false # true, false (default)
words_per_minute         : 200
enable_copy_code_button  : true
```

```yaml
# 用于设置评论系统
comments:
  # 在provider这儿选择评论系统，而之后都是各个系统的设置。
  provider               : "false" # false (default), "disqus", "discourse", "facebook", "staticman_v2", "staticman", "utterances", "giscus", "custom"
  disqus:
    shortname            :
  facebook:
    # https://developers.facebook.com/docs/plugins/comments
    appid                :
    num_posts            : # 5 (default)
    colorscheme          : # "light" (default), "dark"
```

```yaml
# 用于设置人机验证(?)
reCaptcha:
  siteKey                : # "6LdRBykTAAAAAFB46MnIu6ixuxwu9W1ihFF8G60Q"
  secret                 : # "PznnZGu3P6eTHRPLORniSq+J61YEf+A9zmColXDM5icqF49gbunH51B8+h+i2IvewpuxtA9TFoK68TuhUp/X3YKmmqhXasegHYabY50fqF9nJh9npWNhvITdkQHeaOqnFXUIwxfiEeUt49Yoa2waRR7a5LdRAP3SVM8hz0KIBT4="
```

```yaml
# 用于设置网页的订阅源(?)
atom_feed:
  path                   : # blank (default) uses feed.xml
```

```yaml
# 用于设置网页的搜索功能
search                   : true # true, false (default)
search_full_content      : true # true, false (default)
search_provider          : algolia # lunr (default), algolia
algolia:
  application_id         : QB6HVGBSBA # YOUR_APPLICATION_ID
  index_name             : minimal_mistakes # YOUR_INDEX_NAME
  search_only_api_key    : 9d5014e5bbc77372547bce778dfa5663 # YOUR_SEARCH_ONLY_API_KEY
  powered_by             : true # true (default), false
  files_to_exclude:
    - _posts/2017-11-28-post-exclude-search.md
```

```yaml
# 用于向各大搜索引擎证明你对网站的所有权。
google_site_verification : "UQj93ERU9zgECodaaXgVpkjrFn9UrDMEzVamacSoQ8Y" # Replace this with your ID, or delete
bing_site_verification   :
naver_site_verification  :
yandex_site_verification :
baidu_site_verification  :
```

```yaml
# 当你的网页在社交平台（Twitter、Facebook 等）被分享时，这些参数控制显示的内容。
twitter:
  username               : &twitter "mmistakes"
facebook:
  username               : &facebook "michaelrose"
  app_id                 :
  publisher              :
og_image                 : "/assets/images/site-logo.png" # Open Graph/Twitter default site image
```

```yaml
# 定义网站所属的个人或组织信息；用于生成结构化数据（structured data），帮助搜索引擎识别网站归属。
social:
  type                   : # Person or Organization (defaults to Person)
  name                   : # If the user or organization name differs from the site's name
  links: # An array of links to social media profiles
    - "https://twitter.com/mmistakes"
    - "https://www.facebook.com/michaelrose"
```

```yaml
# 用于网站流量统计和分析。
analytics:
  provider               : "google-universal" # false (default), "google", "google-universal", "google-gtag", "custom"
  google:
    tracking_id          : "UA-2011187-3" # Replace this with your ID, or delete
    anonymize_ip         : true
```

```yaml
# 定义网站作者的基本信息，用于文章页的作者简介（author profile）或网站其它地方。
author:
  name             : *name # *name is a YAML reference pointing to the &anchor earlier
  avatar           : "/assets/images/michael-rose.jpg"
  bio              : "Just another *boring*, *tattooed*, *time traveling*, *designer*."
  location         : "Buffalo, NY"
  links:
    - label: "Made Mistakes"
      icon: "fas fa-fw fa-link"
      url: "https://mademistakes.com"
    - label: "Twitter"
      icon: "fab fa-fw fa-twitter-square"
      url: "https://twitter.com/mmistakes"
    - label: "GitHub"
      icon: "fab fa-fw fa-github"
      url: "https://github.com/mmistakes"
    - label: "Instagram"
      icon: "fab fa-fw fa-instagram"
      url: "https://instagram.com/mmistakes"
```

```yaml
# 控制网站底部显示的内容。
footer:
  links:
    - label: "Twitter"
      icon: "fab fa-fw fa-twitter-square"
      url: "https://twitter.com/mmistakes"
    - label: "GitHub"
      icon: "fab fa-fw fa-github"
      url: "https://github.com/mmistakes"
    - label: "Instagram"
      icon: "fab fa-fw fa-instagram"
      url: "https://instagram.com/mmistakes"
  since: "2013"
```

```yaml
# 告诉 Jekyll 在构建网站时哪些文件需要处理，哪些需要忽略。
include:
  - .htaccess
  - _pages
exclude:
  - "*.sublime-project"
  - "*.sublime-workspace"
  - vendor
  - .asset-cache
  - .bundle
  - .jekyll-assets-cache
  - .sass-cache
  - assets/js/plugins
  - assets/js/_main.js
  - assets/js/vendor
  - Capfile
  - CHANGELOG
  - config
  - Gemfile
  - Gruntfile.js
  - gulpfile.js
  - LICENSE
  - log
  - node_modules
  - package.json
  - Rakefile
  - README
  - tmp
# 构建后仍保留在输出目录（_site）里的文件。
keep_files:
  - .git
  - .svn
encoding: "utf-8"
markdown_ext: "markdown,mkdown,mkdn,mkd,md"
```

```yaml
# 控制 Markdown 的解析和高亮。

# Conversion
markdown: kramdown
highlighter: rouge
lsi: false
excerpt_separator: "\n\n"
incremental: false

# Markdown Processing
kramdown:
  input: GFM
  hard_wrap: false
  auto_ids: true
  footnote_nr: 1
  entity_output: as_char
  toc_levels: 1..6
  smart_quotes: lsquo,rsquo,ldquo,rdquo
  enable_coderay: false
```

```yaml
# 定义自定义内容类型（非博客文章的内容集合）。output: true表示在网站中生成页面。
collections:
  docs:
    output: true
    permalink: /:collection/:path/
  recipes:
    output: true
    permalink: /:collection/:path/
  pets:
    output: true
    permalink: /:collection/:path/
  portfolio:
    output: true
    permalink: /:collection/:path/
```

```yaml
# 为不同类型内容设置默认值，避免每篇文章或页面都重复配置。
defaults:
  # _posts
  - scope:
      path: ""
      type: posts
    values:
      layout: single
      author_profile: true
      read_time: true
      comments: true
      share: true
      related: true
  # _pages
  - scope:
      path: "_pages"
      type: pages
    values:
      layout: single
      author_profile: true
```

```yaml
# 配置 Jekyll 如何处理 Sass/SCSS 文件。
sass:
  sass_dir: _sass
  style: compressed # http://sass-lang.com/documentation/file.SASS_REFERENCE.html#output_style
```

```yaml
# 控制文章 URL 结构：`/:categories/:title/` → URL 会是 `网站域名/分类名/文章标题/`
permalink: /:categories/:title/
# 表示每页显示文章数量
paginate: 5
# 表示分页路径
paginate_path: /page:num/
# 用于文章日期时间显示和 RSS Feed 时间戳。
timezone: America/New_York
```

```yaml
# 增加网站功能，通过插件扩展 Jekyll。
plugins:
  - jekyll-paginate
  - jekyll-sitemap
  - jekyll-gist
  - jekyll-feed
  - jemoji
  - jekyll-include-cache
  
# mimic GitHub Pages with --safe
whitelist:
  - jekyll-paginate
  - jekyll-sitemap
  - jekyll-gist
  - jekyll-feed
  - jemoji
  - jekyll-include-cache
```

```yaml
# 生成分类和标签归档页。
# Archives
#  Type
#  - GitHub Pages compatible archive pages built with Liquid ~> type: liquid (default)
#  - Jekyll Archives plugin archive pages ~> type: jekyll-archives
#  Path (examples)
#  - Archive page should exist at path when using Liquid method or you can
#    expect broken links (especially with breadcrumbs enabled)
#  - <base_path>/tags/my-awesome-tag/index.html ~> path: /tags/
#  - <base_path>/categories/my-awesome-category/index.html ~> path: /categories/
#  - <base_path>/my-awesome-category/index.html ~> path: /
category_archive:
  type: liquid
  path: /categories/
tag_archive:
  type: liquid
  path: /tags/
# https://github.com/jekyll/jekyll-archives
# jekyll-archives:
#   enabled:
#     - categories
#     - tags
#   layouts:
#     category: archive-taxonomy
#     tag: archive-taxonomy
#   permalinks:
#     category: /categories/:name/
#     tag: /tags/:name/
```

```yaml
# 在构建网站时压缩 HTML，减少文件体积，加快加载速度。
compress_html:
  clippings: all # 表示压缩所有空格、换行、注释。
  ignore:
    envs: development # 表示开发环境下不压缩，方便调试。
```

### _layouts的html文件配置

#### default.html

```html
{% raw %}---
---

<!doctype html> <!--HTML5声明-->
{% include copyright.html %} <!--包含版权声明的 meta 信息或 HTML 注释。-->

<!-- Note.1 -->
<html lang="{{ site.locale | replace: "_", "-" | default: "en" }}" class="no-js">
  <head>
    {% include head.html %}
    {% include head/custom.html %}
  </head>

  <body class="layout--{{ page.layout | default: layout.layout }}
               {% if page.classes or layout.classes %}
               {{ page.classes | default: layout.classes | join: ' ' | prepend: ' ' }}
               {% endif %}" 
        dir="{% if site.rtl %}rtl{% else %}ltr{% endif %}">
     
    <!-- Note.2 -->
    {% include_cached skip-links.html %} <!-- 辅助功能，提供“跳过导航到内容”的无障碍功能。 -->
    {% include_cached masthead.html %} <!-- 网站头部导航，包括 logo、菜单、搜索按钮等。 -->

    <div class="initial-content">
      {{ content }}
      {% include after-content.html %}
    </div>

    {% if site.search == true %}
      <div class="search-content">
        {% include_cached search/search_form.html %}
      </div>
    {% endif %}

    <div id="footer" class="page__footer">
      <footer>
        {% include footer/custom.html %}
        {% include_cached footer.html %}
      </footer>
    </div>

    {% include scripts.html %}
  </body>
</html>{% endraw %}
```

​	**Note.1：**这里使用了HTML语法和Liquid模板语法。**首先是HTML部分**，HTML是一种标记语言，通过**元素**来描述网页内容的结构与语义，元素的基本结构如下：

~~~html
<标签名 属性名="属性值">内容</标签名>
~~~

此处的`<html>...</html>`是一种特殊的标签，用于定义网页的根节点，除此之外，还有其余标签名：

|   类别   |           标签           |           作用 / 描述           |    类别    |           标签            |  作用 / 描述   |
| :------: | :----------------------: | :-----------------------------: | :--------: | :-----------------------: | :------------: |
| 文档结构 |         `<html>`         |           网页根元素            |  文本内容  |      `<blockquote>`       |    引用文字    |
| 文档结构 |         `<head>`         | 页面头部，存放元信息、CSS、脚本 |  文本内容  |         `<code>`          |    代码片段    |
| 文档结构 |         `<body>`         |          页面可见内容           |  文本内容  |          `<pre>`          |  保留格式文本  |
| 文档结构 |        `<title>`         |  网页标题，显示在浏览器标签上   | 图片/媒体  |          `<img>`          |    插入图片    |
| 文档结构 |         `<meta>`         | 元信息，如字符集、描述、关键词  | 图片/媒体  |         `<audio>`         |    播放音频    |
| 文档结构 |         `<link>`         |   链接外部资源，如 CSS 或图标   | 图片/媒体  |         `<video>`         |    播放视频    |
| 文档结构 |        `<style>`         |      在页面中嵌入 CSS 样式      | 图片/媒体  |        `<iframe>`         |    内嵌网页    |
| 布局容器 |         `<div>`          |          通用块级容器           |    表格    |         `<table>`         |    表格容器    |
| 布局容器 |       `<section>`        |         文档中独立区块          |    表格    |          `<tr>`           |     表格行     |
| 布局容器 |        `<header>`        |         页眉或章节头部          |    表格    |          `<th>`           |   表头单元格   |
| 布局容器 |        `<footer>`        |              页脚               |    表格    |          `<td>`           | 表格数据单元格 |
| 布局容器 |         `<main>`         |         页面主要内容区          | 表单/交互  |         `<form>`          |    表单容器    |
| 布局容器 |         `<nav>`          |             导航栏              | 表单/交互  |         `<input>`         |     输入框     |
| 布局容器 |       `<article>`        |       独立文章或博客内容        | 表单/交互  |       `<textarea>`        |   多行文本框   |
| 布局容器 |        `<aside>`         |             侧边栏              | 表单/交互  |  `<select>` / `<option>`  |    下拉选择    |
| 文本内容 |          `<p>`           |              段落               | 表单/交互  |        `<button>`         |      按钮      |
| 文本内容 |      `<h1>`~`<h6>`       |     标题（1 最大，6 最小）      | 表单/交互  |         `<label>`         |   输入框说明   |
| 文本内容 |          `<a>`           |             超链接              | 语义化标签 |         `<time>`          |    时间标记    |
| 文本内容 |        `<strong>`        |            加粗强调             | 语义化标签 |         `<mark>`          |    高亮文本    |
| 文本内容 |          `<em>`          |            斜体强调             | 语义化标签 | `<details>` / `<summary>` |    折叠内容    |
| 文本内容 |          `<br>`          |              换行               | 语义化标签 |       `<progress>`        |     进度条     |
| 文本内容 |          `<hr>`          |           水平分割线            | 语义化标签 |         `<meter>`         |   数值指示器   |
| 文本内容 | `<ul>` / `<ol>` / `<li>` |    列表（无序、有序、项目）     |            |                           |                |

而其中的两个属性`lange`和`class`，前者是声明网页的语言环境，后者是用于检测浏览器是否支持JavaScript。**然后是Liquid模板语法部分**，`{ { ... } }`用于表述输出变量的值，在渲染网站时，Jekyll会用变量的值来替换这里的内容；`site.local`则是一个全局变量，可在`_config.yml`中配置；`| ...`是过滤器语法，表示对前面结果进行处理，`replace: "_", "-"`表示将`_`替换为`-`，而`default: "en"`则表示若前面的值为空，则设为默认值`en`。

​	**Note.2**：`include`是用于动态内容，需要每次都重新渲染，而`include_cached`适用于静态内容，例如通用头部、脚本等，仅渲染一次，之后都是复用之前渲染的结果。

#### single.html

```html
{% raw %}---
layout: default
---

<!-- 顶部大图设置 -->
{% if page.header.overlay_color or page.header.overlay_image or page.header.image %}
  {% include page__hero.html %}
{% elsif page.header.video.id and page.header.video.provider %}
  {% include page__hero_video.html %}
{% endif %}

<!-- 面包屑导航 -->
{% assign breadcrumbs_enabled = site.breadcrumbs %}
{% if page.breadcrumbs != null %}
  {% assign breadcrumbs_enabled = page.breadcrumbs %}
{% endif %}
{% if page.url != "/" and breadcrumbs_enabled %}
  {% unless paginator %}
    {% include breadcrumbs.html %}
  {% endunless %}
{% endif %}

<!-- role是HTML的可访问性属性，用于辅助残障用户、屏幕阅读器或辅助工具理解页面结构 -->
<div id="main" role="main">
  {% include sidebar.html %}

  <!-- Note.1 -->
  <article class="page" itemscope itemtype="https://schema.org/CreativeWork"{% if page.locale %} lang="{{ page.locale }}"{% endif %}>
    {% if page.title %}<meta itemprop="headline" content="{{ page.title | replace: '|', '&#124;' | markdownify | strip_html | strip_newlines | escape_once }}">{% endif %}
    {% if page.excerpt %}<meta itemprop="description" content="{{ page.excerpt | markdownify | strip_html | strip_newlines | escape_once }}">{% endif %}
    {% if page.date %}<meta itemprop="datePublished" content="{{ page.date | date_to_xmlschema }}">{% endif %}
    {% if page.last_modified_at %}<meta itemprop="dateModified" content="{{ page.last_modified_at | date_to_xmlschema }}">{% endif %}

    <div class="page__inner-wrap">
      {% unless page.header.overlay_color or page.header.overlay_image %}
        <header>
          {% if page.title -%}
          <h1 id="page-title" class="page__title" itemprop="headline">
            <a href="{{ page.url | absolute_url }}" itemprop="url">
                <!-- 网页标题显示 -->
                {{ page.title | markdownify | remove: "<p>" | remove: "</p>" }}</a>
          </h1>
          {%- endif %}
          {% include page__meta.html %}
        </header>
      {% endunless %}

      <section class="page__content" itemprop="text">
        <!-- 网页的toc显示 --> 
        {% if page.toc %}
          <aside class="sidebar__right {% if page.toc_sticky %}sticky{% endif %}">
            <nav class="toc">
              <header><h4 class="nav__title"><i class="fas fa-{{ page.toc_icon | default: 'file-alt' }}"></i> {{ page.toc_label | default: site.data.ui-text[site.locale].toc_label | default: "On this page" }}</h4></header>
              {% include toc.html sanitize=true html=content h_min=1 h_max=6 class="toc__menu" skip_no_ids=true %}
            </nav>
          </aside>
        {% endif %}
        {{ content }}
        {% if page.link %}<div><a href="{{ page.link }}" class="btn btn--primary">{{ site.data.ui-text[site.locale].ext_link_label | default: "Direct Link" }}</a></div>{% endif %}
      </section>

      <footer class="page__meta">
        {% if site.data.ui-text[site.locale].meta_label %}
          <h4 class="page__meta-title">{{ site.data.ui-text[site.locale].meta_label }}</h4>
        {% endif %}
        {% include page__taxonomy.html %}
        {% include page__date.html %}
      </footer>

      {% if page.share %}{% include social-share.html %}{% endif %}

      {% include post_pagination.html %}
    </div>

    {% if site.comments.provider and page.comments %}
      {% if jekyll.environment == 'production' %}
        {% include comments.html %}
      {% else %}
        <p>
          Comments are configured with provider: <strong>{{ site.comments.provider }}</strong>,
          but are disabled in non-production environments.
        </p>
      {% endif %}
    {% endif %}
  </article>

  {% comment %}<!-- only show related on a post page when `related: true` -->{% endcomment %}
  {% if page.id and page.related and site.related_posts.size > 0 %}
    {% include page__related.html posts=site.related_posts %}
  {% comment %}<!-- otherwise show recent posts if no related when `related: true` -->{% endcomment %}
  {% elsif page.id and page.related %}
    {% include page__related.html posts=site.posts %}
  {% endif %}
</div>{% endraw %}
```

​	**Note.1**：`itemscope`和`itemtype`属性用于定义SEO（Search Engine Optimization，搜索引擎优化）相关属性，来**让搜索引擎理解页面内容的结构和含义**。后面的`<meta>`标签都是定义SEO元数据信息。

### TOC模块自定义

​	TOC（Table of Contents，目录）模块是主题中用于显示博客文章大纲的组件。它不仅列出文章的各级标题，还可以点击跳转到对应的内容位置。默认情况下，该模块在主题中只能显示在文章的右侧。本文尝试将 TOC 模块移动到文章左侧，同时实现颜色和样式的自定义，如当前页面所示。

在修改 TOC 位置之前，需要先了解主题项目中不同类型文件的作用：

- `.html` 文件：控制网页布局，决定各个模块在页面中的位置和结构。
- `.scss` 文件：控制模块样式，包括字体大小、颜色、间距以及动画效果等。

掌握这两类文件的功能有助于准确定位 TOC 模块的布局和样式，从而进行自定义调整。由此看来，自定义TOC的思路应该是先找到定义文章页面布局的`.html`文件，调整布局，然后找到定义了TOC模块的`.scss`样式文件，进行模块内容样式的自定义。

​	通过查询[官方教程](https://mmistakes.github.io/minimal-mistakes/docs/quick-start-guide/)知道博客页面布局类型采用的是**Single类型布局**，对应文件`_layouts/single.html`，阅读代码可知TOC模块被布置到了文章内容的子级（`<article>标签内`），而期望是能和文章内容平级并位于文章内容左侧，原主题是提供了左栏模块的定义的，但是仅提供显示作者信息、标题图片或文章导航，因此参考左栏模块对应的代码行，将TOC模块对应的代码移动到该位置，修改后如下所示（可与前面的`single.html`文件对比）：

```html
{% raw %}<div id="main" role="main">
    <!-- 网页的toc显示 -->
    {% if page.toc %}
    <aside class="sidebar__right {% if page.toc_sticky %}sticky{% endif %}">
        <nav class="toc">
            <header><h4 class="nav__title"><i class="fas fa-{{ page.toc_icon | default: 'file-alt' }}"></i> {{ page.toc_label | default: site.data.ui-text[site.locale].toc_label | default: "On this page" }}</h4></header>
            {% include toc.html sanitize=true html=content h_min=1 h_max=6 class="toc__menu" skip_no_ids=true %}
        </nav>
    </aside>
    {% endif %}
    {% include sidebar.html %}

    <article class="page" itemscope itemtype="https://schema.org/CreativeWork" {% if page.locale %} lang="{{ page.locale }}" {% endif %}>
        {% if page.title %}<meta itemprop="headline" content="{{ page.title | replace: '|', '&#124;' | markdownify | strip_html | strip_newlines | escape_once }}">{% endif %}
        {% if page.excerpt %}<meta itemprop="description" content="{{ page.excerpt | markdownify | strip_html | strip_newlines | escape_once }}">{% endif %}
        {% if page.date %}<meta itemprop="datePublished" content="{{ page.date | date_to_xmlschema }}">{% endif %}
        {% if page.last_modified_at %}<meta itemprop="dateModified" content="{{ page.last_modified_at | date_to_xmlschema }}">{% endif %}

        <div class="page__inner-wrap">
            {% unless page.header.overlay_color or page.header.overlay_image %}
            <header>
                {% if page.title -%}
                <h1 id="page-title" class="page__title" itemprop="headline">
                    <a href="{{ page.url | absolute_url }}" itemprop="url">{{ page.title | markdownify | remove: "<p>" | remove: "</p>" }}</a>
                </h1>
                {%- endif %}
                {% include page__meta.html %}
            </header>
            {% endunless %}

            <section class="page__content" itemprop="text">
                {{ content }}
                {% if page.link %}<div><a href="{{ page.link }}" class="btn btn--primary">{{ site.data.ui-text[site.locale].ext_link_label | default: "Direct Link" }}</a></div>{% endif %}
            </section>
            ... ...{% endraw %}
```

然后是寻找定义该模块的样式文件，可以从上述代码看到影响这个模块的样式文件有哪些（从选择的**class名字**可以看到），包括了`sidebar__right`、`toc`、`nav__title`和`toc__menu`，通过查找可以确定分别位于主题项目的文件：`_sass/minimal-mistakes/_sidebar.scss`和`_navigation.scss`。由于原来的TOC模块定义在文章内容模块内，并且位于右边，一些位置参数不适合左栏，防止其他模块也使用了该类情况，我们重新定义一个样式来控制TOC模板，即`sidebar__left`，内容如下：

```scss
.sidebar__left {
    @include clearfix();

    @include breakpoint($large) {
        float: inline-start;
        width: calc(#{$right-sidebar-width-narrow} - 1em);
        //opacity: 0.75;
        //-webkit-transition: opacity 0.2s ease-in-out;
        //transition: opacity 0.2s ease-in-out;

        //&:hover {
        //    opacity: 1;
        //}

        &.sticky {
            .toc {
                .toc__menu {
                    overflow-y: auto;
                    max-height: calc(100vh - 7em);
                }
            }
        }
    }

    @include breakpoint($x-large) {
        width: calc(#{$right-sidebar-width} - 1em);
    }

    > * {
        margin-top: 1em;
        margin-bottom: 1em;
    }
}
```

其中各个参数的设置参考样式`sidebar`和`sidebar__right`，在定义好`sidebar__left`后，将`single.html`里TOC模块对应位置的**class名称**修改即可在网页左栏看到目录显示。

最后是在`_navigation.scss`文件中可以看到对样式`toc`、`nav_title`和`toc__menu`的定义，可以根据自己的喜好定义不同的参数。

### 首页布局自定义并插入动画

官方提供了多个网页布局，例如splash、single等，位于文件夹`_layouts`中。现在想自定义一个首页布局，期望能够自定义一个网页横幅，并且会使用类似打字的动画展示横幅中的文本。

首先自定义一个控制网页布局的html文件：`homepage.html`。该布局会继承官方的`default.html`，因为该布局定义了网页头部导航、末尾等布局，文件完整内容如下：

```html
{% raw %}---
layout: default
---

{% assign bg_color = page.header.color %}
<div class="home__image animate-reveal" 
     style="width:100%; height:400px; {% if bg_color %}background-color: {{ bg_color }};{% endif %}">
    <div class="content">
        <div class="typing-js" aria-live="polite"></div>
    </div>
</div>
<script src="/assets/js/typewriter.js"></script>


<div id="main" role="main">
    <article class="splash" itemscope itemtype="https://schema.org/CreativeWork" {% if page.locale %} lang="{{ page.locale }}" {% endif %}>
        {% if page.title %}<meta itemprop="headline" content="{{ page.title | markdownify | strip_html | strip_newlines | escape_once }}">{% endif %}
        {% if page.excerpt %}<meta itemprop="description" content="{{ page.excerpt | markdownify | strip_html | strip_newlines | escape_once }}">{% endif %}
        {% if page.date %}<meta itemprop="datePublished" content="{{ page.date | date_to_xmlschema }}">{% endif %}
        {% if page.last_modified_at %}<meta itemprop="dateModified" content="{{ page.last_modified_at | date_to_xmlschema }}">{% endif %}
        <section class="page__content" itemprop="text">
            {{ content }}
        </section>
    </article>
</div>{% endraw %}
```

该文件包含两个部分，第一部分是标签为`<div>`的横幅元素，用`home__image animate-reveal`来定义这个元素的样式，用`style`来定义这个元素的样式，包括宽高、背景颜色。在该元素内还包含一个`<div>`来定义横幅中的文本，并且用`content`来定义样式。因此对应的样式为：

```css
.home__image {
    display: block;
    margin: 0 auto;
    position: relative;
    .content {
        position: absolute;
        inset: 0;
        display: flex;
        align-items: center;
        justify-content: center;
    }
    &.animate-reveal {
        transform-origin: center;
        transform: scaleX(0);
        animation: reveal-horizontal 1.2s ease-out forwards;
    }
}

@keyframes reveal-horizontal {
    0% {
        transform: scaleX(0);
    }

    100% {
        transform: scaleX(1);
    }
}
```

`&.animate-reveal`表示当`class`为`home__image animate-reveal`时才会使用这个样式设置，如果仅仅是`home__image`则不会使用，而`content`则表示若父元素为`home__image`或`home__image animate-reveal`，则所有使用样式`content`的子元素都会使用该样式。

`@keyframes`则是用来定义CSS动画的关键词，基本语法为：

```css
@keyframes animation-name {
  0% { property: value; }
  50% { property: value; }
  100% { property: value; }
}
```

该语法中定义动画各个阶段的关键帧，然后在样式中进行调用，例如`animation: reveal-horizontal 1.2s ease-out forwards;`，其中`ease-out`表示动画缓动函数，即动画进行时速度的变化，`forward`则表示动画填充模式，即动画结束后元素的状态。

此处的`.content`仅控制了文本的显示位置。具体文本样式和动画效果则有样式`typing-js`来控制，该样式的定义如下：

```css
.typing-js {
    font-family: "Consolas", monospace;
    font-size: 2rem;
    font-weight: 400;
    color: #fff;
    white-space: pre-wrap;
    min-height: 1.2em;
    text-align: center;
}

.typing-js::after {
    content: "";
    display: inline-block;
    width: .12em;
    height: 1em;
    margin-left: .12em;
    vertical-align: middle;
    background: currentColor; 
    opacity: 0;
    transition: opacity .12s linear;
}

.typing-js.caret-visible::after {
    opacity: 1;
    animation: blink-caret .7s steps(1) infinite;
}

@keyframes blink-caret {
    0%,100% {
        opacity: 1;
    }

    50% {
        opacity: 0;
    }
}
```

`::after`属于伪元素，表明在`.typing-js`内容后生成一个虚拟元素，此处为定义光标，而`.typing-js.caret-visible::after`则是用于定义光标闪烁控制的动画。接下来需要定义一个JavaScript函数来控制动画，此处创建一个`typewriter.js`文件，放在`/assets/js`文件夹中，并且在html布局文件中使用`<script>`标签来导入该文件。文件具体内容如下：

```javascript
function typewriter(el, text, options = {}) {
    const delay = options.delay ?? 60; // 每字符 60ms
    const loop = options.loop ?? false;
    const pauseAfter = options.pauseAfter ?? 1200; // 全文显示后停留时间
    let i = 0;
    el.textContent = "";
    function step() {
        if (i < text.length) {
            el.textContent += text[i++];
            setTimeout(step, delay);
        } else {
            el.classList.remove("caret-visible");

            if (loop) {
                setTimeout(() => {
                    el.textContent = "";
                    i = 0;
                    setTimeout(step, 300);
                }, pauseAfter);
            }
        }
    }
    step();
}


document.addEventListener("DOMContentLoaded", function () {
    const parent = document.querySelector(".home__image.animate-reveal");
    const el = document.querySelector(".typing-js");
    const text = "Welcome to the Code Island\nBeyond lines of code lies a journey :)";

    if (!el) return; 
    function showCaretAndStartTyping() {
        el.classList.add("caret-visible");
        const delayBeforeTyping = 120; 
        setTimeout(() => typewriter(el, text, { delay: 50 }), delayBeforeTyping);
    }

    if (!parent) {
        showCaretAndStartTyping();
        return;
    }

    const handler = (e) => {
         //if (e.animationName !== 'reveal-horizontal') return;
        showCaretAndStartTyping();
        parent.removeEventListener("animationend", handler);
    };
    parent.addEventListener("animationend", handler, { once: true });

    const maxWait = 3000; 
    setTimeout(() => {
        if (!el.classList.contains("caret-visible")) {
            showCaretAndStartTyping();
            parent.removeEventListener("animationend", handler);
        }
    }, maxWait);
});
```

该文件同样包含两部分，第一部分是定义用于显示文本动画的函数，第二部分则是注册事件监听器，用来监听网页流程并执行相应步骤。此处的`DOMContentLoaded`是指在页面的**HTML 解析完成、DOM 树构建完成** 时触发，而`document.querySelector`则是JavaScript提供的DOM查询方法，用来在整个文档中找到第一个匹配的元素。

`const handler = (e) =>{}`表示函数定义，`handler`为函数名，而`e`为参数，通常为事件对象。`setTimeout(function, delay,...)`表示定时器函数，表示在`delay`时间后执行`function`。



## 部署遇到的问题

### 解决GitHub Pages无法正确显示网页图标问题

网页项目在本地部署时可以正常显示，但是部署到GitHub Pages后无法正确显示，通过`F12`开发者工具确定问题在于浏览器在拉取`Font Awesome`的CSS时连接超时。因此通过**本地化Font Awesome**来解决。

首先在[图标网站](https://fontawesome.com/download)上下载免费素材包，将素材包中的`css/all.min.css`文件和`webfonts`文件夹放入项目文件的`assets`文件夹中，结构如下：

```lua
└─ assets/
    └─ vendor/
        └─ fontawesome/
            ├─ css/
            │   └─ all.min.css
            └─ webfonts/
                ├─ fa-solid-900.woff2
                ├─ fa-brands-400.woff2
                └─ ...

```

然后在项目中创建`_includes/head.html`来覆盖原主题中对应的文件，并且将原文件中的：

```html
<link rel="preload" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@latest/css/all.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
<noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@latest/css/all.min.css"></noscript>

```

替换为：

```html
<link rel="stylesheet" href="{{ '/assets/vendor/fontawesome/css/all.min.css' | relative_url }}">
```

即可解决问题。
